(function(){var a={};if(typeof Object.extend==="undefined"){a.extend=function(d,f){for(var e in f){if(f.hasOwnProperty(e)){d[e]=f[e]}}return d}}else{a.extend=Object.extend}function c(f,e){var d="0.5";this.target=f;if(S(this.target).length==0){return{}}this.attr=e||{};this.bins;this.events={resize:""};this.attr.units=(typeof this.attr.units==="undefined")?"":this.attr.units;this.attr.formatKey=(typeof this.attr.formatKey==="undefined")?function(g){return g}:this.attr.formatKey;this.parent=(typeof this.attr.parent==="undefined")?this:this.attr.parent;this.drawn=false;this.max=this.attr.max||undefined;this.min=this.attr.min||undefined;this.inc=this.attr.inc||undefined;this.mintick=this.attr.mintick||3;this.bin=(typeof this.attr.bin==="function")?this.attr.bin:function(g){return(this.typ==="string"?this.fields[g]:Math.floor((g-this.min)/this.inc))};this.version=function(){return d};return this}c.prototype.isSelected=function(d){b=this.bin(d);if(typeof d==="undefined"){b=0}if(b>=this.nbins){b=this.nbins-1}if(b<0){b=0}return(typeof this.bins[b].selected==="boolean")?this.bins[b].selected:true};c.prototype.select=function(e){for(var d=0;d<this.nbins;d++){if(e=="all"){this.bins[d].selected=true}else{this.bins[d].selected=false}if(this.bins[d].selected){S("#"+this.bins[d].id).removeClass("deselected")}else{S("#"+this.bins[d].id).addClass("deselected")}}return this};c.prototype.toggleBin=function(d){this.bins[d].selected=!this.bins[d].selected;S("#"+this.bins[d].id+"").toggleClass("deselected");return this};c.prototype.setData=function(d){if(d&&typeof d.length==="number"){this.data=d}return this};c.prototype.setBins=function(n){if(!n){n={}}var k=false;var j=(this.data.length>0&&typeof this.data[0][0]==="string")?"string":"number";if(this.typ&&j!=this.typ){k=true}if(n.update){k=true}this.typ=j;if(typeof n.inc==="undefined"){n.inc=this.inc}if(typeof n.max==="undefined"){n.max=this.max}if(typeof n.min==="undefined"){n.min=this.min}if(typeof n.mintick==="undefined"){n.mintick=this.mintick}if(n.inc!=this.inc){k=true}if(n.min!=this.min){k=true}if(n.max!=this.max){k=true}if(this.typ=="number"){if(typeof n.inc!=="number"){k=true}if(typeof n.min!==j){k=true}if(typeof n.max!==j){k=true}if(typeof n.mintick!=="number"){k=true}}if(!this.bins){k=true}if(j==="string"){var l=0;if(k){this.fields={};this.bins={};for(var d=0;d<this.data.length;d++){if(!this.fields[this.data[d][0]]){this.fields[this.data[d][0]]=l;l++}p=this.fields[this.data[d][0]];if(!this.bins[p]){this.bins[p]={selected:true}}if(this.bins[p].key!=this.data[d][0]){this.bins[p].key=this.data[d][0];this.drawn=false}}this.nbins=l}for(var p in this.bins){this.bins[p].value=0}}else{if(k){var q=1e+100;var m=-1e+100;var g={};for(var i=0;i<this.data.length;i++){if(this.data[i][0]<q){q=this.data[i][0]}if(this.data[i][0]>m){m=this.data[i][0]}}if(n.inc&&!n.update){g.max=(n.max)?n.max:m;g.min=(n.min)?n.min:q;g.inc=n.inc}else{g=this.getGrid(q,m,n.mintick)}g.range=g.max-g.min;g.bins=Math.ceil(g.range/g.inc)+1;this.drawn=false;this.bins=[];this.max=g.max;this.min=g.min;this.inc=g.inc;this.range=g.range;this.nbins=g.bins}if(typeof this.nbins!=="number"){this.nbins=Math.ceil(this.range/this.inc)}for(var p=0;p<=this.nbins;p++){if(!this.bins[p]){this.bins[p]={selected:true}}this.bins[p].value=0;this.bins[p].key=""+(this.min+p*this.inc)}}if(n.mintick){this.mintick=n.mintick}for(var d=0;d<this.data.length;d++){p=this.bin(this.data[d][0]);this.bins[p].value+=this.data[d][1]}return this};c.prototype.draw=function(){var f=this.target.substr(1);if(!this.target||!this.bins){return this}var r=0;if(this.nbins>0){if(S(this.target+" .label").length==0){S(this.target).append('<span class="label">label</span>')}if(!this.lineheight){this.lineheight=S(this.target).find(".label")[0].offsetHeight}if(!this.height){this.height=S(this.target)[0].offsetHeight||200}h=this.height-this.lineheight;for(var q=0;q<this.nbins;q++){if(this.bins[q].value>r){r=this.bins[q].value}}if(!this.drawn){S(this.target).addClass("barchart").html('<div class="grid" style="height:'+(h)+'px;"></div><table style="height:'+this.height+'px"><tr style="vertical-align:bottom;"></tr></table><div style="clear:both;"></div>')}var d=this.getGrid(0,r);var i="";for(var l=0;l<=d.max;l+=d.inc){i+='<div class="line" style="bottom:'+(h*l/r)+'px;"><span>'+(this.attr.units||"")+this.formatNumber(l)+"</span></div>"}S(this.target+" .grid").html(i);var o=(S(this.target+" table td").length==0);i="";var s,k,n,m,j,e;for(var q=0;q<this.nbins;q++){s=this.bins[q].key;k=(r>0?(h*this.bins[q].value/r).toFixed(1):0);n=Math.round(h-k);m=h-n;if(m<1){n--}j=f+"-bar-"+(typeof s==="string"?q:s.replace(/ /g,"-"));this.bins[q].id=j;if(o){i+='<td id="'+j+'" style="width:'+(100/this.nbins).toFixed(3)+'%;" class="'+(!this.bins[q].selected?" deselected":"")+'" data-index="'+q+'"><div class="antibar" style="height:'+n+'px;"></div><a href="#" class="bar" title="'+s+": "+(this.attr.units||"")+this.formatNumber(this.bins[q].value)+'" style="height:'+m+'px;"></a>'+(((typeof s==="string"&&s.indexOf("-01"))||s.indexOf("-")==-1)?'<span class="label">'+this.attr.formatKey.call(this,s)+"</span>":"")+"</td>"}else{e=S("#"+j+"");e.attr("class",""+(!this.bins[q].selected?"deselected":""));e.find(".bar").css({height:m+"px"}).attr("title",s+": "+(this.attr.units||"")+this.formatNumber(this.bins[q].value));e.find(".antibar").css({height:n+"px"});e.find(".label").html(this.attr.formatKey.call(this,s))}}if(o){S(this.target+" table tr").html(i);S(this.target).on("mouseleave",{me:this},function(g){if(g.data){g.data.me.trigger("mouseleave",{event:g})}});S(this.target).on("mouseover",{me:this},function(g){g.data.me.trigger("mouseover",{event:g})})}if(!this.drawn){S(this.target+" .bar").on("focus",{me:this,parent:this.attr.parent},function(g){g.currentTarget=g.currentTarget.parentNode;g.data.me.trigger("barover",{event:g,bin:S(g.currentTarget).attr("data-index")})}).parent().on("click",{me:this,parent:this.attr.parent},function(g){g.preventDefault();g.data.me.trigger("barclick",{event:g,bin:S(g.currentTarget).attr("data-index")})}).on("mouseover",{me:this,parent:this.attr.parent},function(g){g.data.me.trigger("barover",{event:g,bin:S(g.currentTarget).attr("data-index")})})}this.drawn=true}return this};c.prototype.on=function(f,g,d){if(typeof f!="string"){return this}if(typeof d=="undefined"){d=g;g={}}else{g={data:g}}if(typeof g!="object"||typeof d!="function"){return this}if(this.events[f]){this.events[f].push({e:g,fn:d})}else{this.events[f]=[{e:g,fn:d}]}return this};c.prototype.off=function(d){if(typeof d!="string"){return this}if(typeof this.events[d]=="object"){this.events[d]=[]}return this};c.prototype.trigger=function(g,d){if(typeof g!="string"){return}if(typeof d!="object"){d={}}var k=[];if(typeof this.events[g]=="object"){for(var f=0;f<this.events[g].length;f++){var j=a.extend(this.events[g][f].e,d);if(typeof this.events[g][f].fn=="function"){k.push(this.events[g][f].fn.call(this,j))}}}if(k.length>0){return k}};c.prototype.getGrid=function(f,l,e){var n=l-f;var d=10;if(!e){e=3}var g=Math.pow(d,Math.floor(Math.log(n)/Math.log(d)));g*=2;var m=(Math.ceil(l/g))*g;if(m<l){m+=g}var k=m;var j=0;do{j++;k-=g}while(k>f);if(Math.abs(k)<1e-15){k=0}while(j<e){g/=2;if((k+g)<=f){k+=g}if((m-g)>=l){m-=g}j=j*2}if(m>l){m-=g}return{min:k,max:m,inc:g,range:m-k}};c.prototype.formatNumber=function(d){if(typeof d!=="number"){return d}if(d>=100000000000){return Math.round(d/1000000000)+"B"}if(d>=10000000000){return(d/1000000000).toFixed(1).replace(/\.?0+$/,"")+"B"}if(d>=1000000000){return(d/1000000000).toFixed(2).replace(/\.?0+$/,"")+"B"}if(d>=100000000){return Math.round(d/1000000)+"M"}if(d>=10000000){return(d/1000000).toFixed(1).replace(/\.0*$/,"")+"M"}if(d>=1000000){return(d/1000000).toFixed(2).replace(/\.0*$/,"")+"M"}if(d>=100000){return Math.round(d/1000)+"k"}if(d>=10000){return Math.round(d/1000)+"k"}return(""+d).replace(/0{5,}1$/,"")};S.barchart=function(f,e,d){return new c(f,e,d)}})(S);